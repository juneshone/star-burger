# Сайт доставки еды Star Burger

Это сайт сети ресторанов Star Burger. Здесь можно заказать превосходные бургеры с доставкой на дом.

![скриншот сайта](https://dvmn.org/filer/canonical/1594651635/686/)

Сеть Star Burger объединяет несколько ресторанов, действующих под единой франшизой. У всех ресторанов одинаковое меню и
одинаковые цены. Просто выберите блюдо из меню на сайте и укажите место доставки. Мы сами найдём ближайший к вам
ресторан, всё приготовим и привезём.

На сайте есть три независимых интерфейса. Первый — это публичная часть, где можно выбрать блюда из меню, и быстро
оформить заказ без регистрации и SMS.

Второй интерфейс предназначен для менеджера. Здесь происходит обработка заказов. Менеджер видит поступившие новые заказы
и первым делом созванивается с клиентом, чтобы подтвердить заказ. После оператор выбирает ближайший ресторан и передаёт
туда заказ на исполнение. Там всё приготовят и сами доставят еду клиенту.

Третий интерфейс — это админка. Преимущественно им пользуются программисты при разработке сайта. Также сюда заходит
менеджер, чтобы обновить меню ресторанов Star Burger.

Ссылка на сайт: https://starburgerrr.ru/

## Как подготовить окружение к локальной разработке

Код в репозитории полностью докеризирован, поэтому для запуска приложения вам понадобится Docker. Инструкции по его
установке ищите на официальных сайтах:

- [Get Started with Docker](https://www.docker.com/get-started/)

Вместе со свежей версией Docker к вам на компьютер автоматически будет установлен Docker Compose. Дальнейшие инструкции
будут его активно использовать.

## Переменнные окружения

Часть данных проекта берётся из переменных окружения. Чтобы их определить, создайте файл `.env` в
каталоге `star_burger/` и присвойте значения переменным окружения в формате: ПЕРЕМЕННАЯ=значение.

- `DEBUG` — дебаг-режим. Для dev-разработки поставьте `True`.
- `SECRET_KEY` — секретный ключ проекта. Он отвечает за шифрование на сайте. Например, им зашифрованы все пароли на
  вашем сайте. Присвойте значение переменной `django-insecure-0if40nf4nf93n4`.
- `ALLOWED_HOSTS` — [см. документацию Django](https://docs.djangoproject.com/en/3.1/ref/settings/#allowed-hosts)
- `YANDEX_MAP_API` — API Яндекс-геокодера. Как получить токен
  смотреть [здесь](https://dvmn.org/encyclopedia/api-docs/yandex-geocoder-api/).
- `ROLLBAR_ACCESS_TOKEN` — токен доступа к проекту для мониторинга исключений в Rollbar. Создайте проект
  по [ссылке](https://rollbar.com/). Выберите свой фреймворк, чтобы начать работу с
  Rollbar SDK, и интегрируйте SDK в ваш проект по инструкции.
- `ENVIRONMENT` — название окружения или инсталляции сайта в Rollbar. Например, `development`.
- `POSTGRES_USER`, `POSTGRES_PASSWORD`, `POSTGRES_DB` - пользователь, пароль и назвние БД postgres.
- `DB_URL` — однострочный адрес к базе данных Postgres в формате `postgres://USER:PASSWORD@dbT:5432/NAME`. Больше
  информации в [документации](https://github.com/jacobian/dj-database-url).

## Как запустить dev-версию сайта

Для работы сайта в dev-режиме будет установлен [Parcel](https://parceljs.org/) — это упаковщик веб-приложений, похожий
на [Webpack](https://webpack.js.org/). В отличии от Webpack он прост в использовании и совсем не требует настроек.
Одновременно будут работать сразу две
программы `runserver` и `parcel`.

Скачайте код:

```sh
git clone https://github.com/devmanorg/star-burger.git
```

Перейдите в каталог проекта:

```sh
cd star-burger
```

В каталоге проекта создайте виртуальное окружение:

```sh
python -m venv venv
```

Активируйте его. На разных операционных системах это делается разными командами:

- Windows: `.\venv\Scripts\activate`
- MacOS/Linux: `source venv/bin/activate`

Запустите базу данных и сайт:

```shell
$ docker-compose -f docker-compose.yaml up
```

Дождитесь завершения первичной сборки. Это вполне может занять 10 и более секунд. О готовности вы узнаете по сообщению в
консоли:

```
✨  Built in 10.89s
```

Готово. Сайт будет доступен по адресу [http://127.0.0.1:8000](http://127.0.0.1:8000). Вход в админку находится по
адресу [http://127.0.0.1:8000/admin/](http://127.0.0.1:8000/admin/).

В новом терминале, не выключая сайт, запустите несколько команд:

```shell
$ docker compose run --rm backend python3 manage.py migrate  # создаём/обновляем таблицы в БД
$ docker compose run --rm backend python3 manage.py createsuperuser  # создаём в БД учётку суперпользователя
$ docker compose run --rm backend python3 manage.py loaddata db.json # при необходимости загрузите тестовые данные в БД
```

Parcel будет следить за файлами в каталоге `bundles-src`. Сначала он прочитает содержимое `index.js` и узнает какие
другие файлы он импортирует. Затем Parcel перейдёт в каждый из этих подключенных файлов и узнает что импортируют они. И
так далее, пока не закончатся файлы. В итоге Parcel получит полный список зависимостей. Дальше он соберёт все эти сотни
мелких файлов в большие бандлы `bundles/index.js` и `bundles/index.css`. Они полностью самодостаточны, и потому пригодны
для запуска в браузере. Именно эти бандлы сервер отправит клиенту.

Теперь если зайти на страницу  [http://127.0.0.1:8000/](http://127.0.0.1:8000/), то вместо пустой страницы вы увидите:

![](https://dvmn.org/filer/canonical/1594651900/687/)

Каталог `bundles` в репозитории особенный — туда Parcel складывает результаты своей работы. Эта директория предназначена
исключительно для результатов сборки фронтенда и потому исключёна из репозитория с помощью `.gitignore`.

**Сбросьте кэш браузера <kbd>Ctrl-F5</kbd>.** Браузер при любой возможности старается кэшировать файлы статики: CSS,
картинки и js-код. Порой это приводит к странному поведению сайта, когда код уже давно изменился, но браузер этого не
замечает и продолжает использовать старую закэшированную версию. В норме Parcel решает эту проблему самостоятельно. Он
следит за пересборкой фронтенда и предупреждает JS-код в браузере о необходимости подтянуть свежий код. Но если вдруг
что-то у вас идёт не так, то начните ремонт со сброса браузерного кэша, жмите <kbd>Ctrl-F5</kbd>.

## Цели проекта

Код написан в учебных целях — это урок в курсе по Python и веб-разработке на сайте [Devman](https://dvmn.org). За основу
был взят код проекта [FoodCart](https://github.com/Saibharath79/FoodCart).
